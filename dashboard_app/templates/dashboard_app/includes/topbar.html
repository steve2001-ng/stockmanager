<!-- dashboard_app/templates/dashboard_app/includes/topbar.html -->
{% load static %}
<nav class="navbar navbar-expand navbar-light bg-white border-bottom">
    <!-- Logo + Titre Ã  gauche -->
    <div class="d-flex align-items-center">
        <a class="navbar-brand" href="{% url 'dashboard_app:dashboard' %}">
            <img src="{% static 'dashboard_app/img/logo.jpg' %}" alt="Logo" height="40" class="logo">
            <span class="fs-4 text-primary">Gestion de la maintenance</span>
        </a>
    </div>

    <!-- Elements Ã  droite -->
    <div class="navbar-collapse justify-content-end">
        <ul class="navbar-nav">

            <!-- Messagerie -->
            <li class="nav-item me-3">
                <a class="nav-link position-relative" href="{% url 'messagerie:message_list' %}">
                    <i class="bi bi-chat-dots fs-5"></i>
                    {% if unread_messages_count > 0 %}
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            {{ unread_messages_count }}
                            <span class="visually-hidden">messages non lus</span>
                        </span>
                    {% endif %}
                </a>
            </li>

            <!-- Notification -->
            <li class="nav-item dropdown me-3">
                <a class="nav-link position-relative" href="#" role="button" data-bs-toggle="dropdown">
                    <i class="bi bi-bell fs-5"></i>
                    {% if due_tasks_count > 0 %}
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            {{ due_tasks_count }}
                        </span>
                    {% endif %}
                </a>
                <ul class="dropdown-menu dropdown-menu-end shadow-sm p-2" style="min-width: 300px;">
                    {% if due_tasks_count > 0 %}
                        {% for task in due_tasks|slice:":5" %}
                            <li class="dropdown-item small">
                                ðŸ”§ {{ task.task_type|capfirst }} â€“ <strong>{{ task.equipment.designation }}</strong><br>
                                <small class="text-muted">Ã‰chÃ©ance : {{ task.next_due|date:"d/m/Y" }}</small>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                        {% endfor %}
                        <li class="dropdown-item text-center">
                            <a href="{% url 'preventive:calendar' %}" class="text-primary">Voir tout</a>
                        </li>
                    {% else %}
                        <li class="dropdown-item text-center text-muted">
                            Aucune tÃ¢che prÃ©ventive en attente.
                        </li>
                    {% endif %}
                </ul>
            </li>

            <!-- Profil utilisateur -->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                    <i class="bi bi-person-circle fs-4 me-2"></i>
                    <span>{{ user.username }}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <a class="dropdown-item" href="{% url 'profile' %}">
                            <i class="bi bi-person me-2"></i> Profil
                        </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item text-danger" href="{% url 'logout' %}">
                            <i class="bi bi-box-arrow-right me-2"></i> DÃ©connexion
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</nav>
